---
layout: default
comments: true
title: (BSN) 4.어쩌다보니 머신러닝?
parent: 프로젝트 진행기
date: 2019.06.08
---

<h1>{{ page.title }}</h1>  
<div style="text-align:right; font-size:11px; color:#aaa">{{ page.date }} </div>

---

본 프로젝트는 다음 링크를통해 확인하실수 있습니다.  
  
Homepage : <http://www.stocknews.me>  
Github : <https://github.com/taes-k/stock_analysis>  

---

## 4. 어쩌다보니 머신러닝?

---

### Positive 알고리즘2

'감성형태소사전'에서 힌트를 얻은 저는 구글링을 더 해보다가 '[의사결정트리](https://ko.wikipedia.org/wiki/결정_트리_학습법)'모델을 적용시켜볼수 있겠다는 생각이 들었습니다. 충분한 샘플 데이터만 있다고 가정하면 형태소로 이루어진 문장들을 형태소별로 끊어 점수를 매긴다면 더 높은 신뢰도를 얻을수 있을것 같았습니다. 다만, 특정 조건들이 아닌 '형태소'로써 의사결정 트리를 사용하기에는 너무나도 많은 학습 데이터가 필요할것 같아 조금더 보완한 랜덤포레스트를 사용해 작업을 진행해보기로 결정했습니다.  
  
랜덤포레스트를 사용하기 위해서는 학습용 샘플 데이터가 필요하기때문에 이번에도 마찬가지로 2,000개  정도의 뉴스를 직접 크롤링해 하나씩  호의도를 판단하여 샘플데이터를 저장시켰습니다. 이를통해 얻어진 학습 데이터는 다음과 같습니다.  
  
```
test, positive
실시간NNG 전국NNG 날씨NNG 오전NNG 현재MAG 대체로MAG 흐림VA ,0
플랫폼NNG 투자NNG 유치NNG ,1
피해NNG 투자NNG 사기NNG 사내NNG 이사NNG 징역NNG ,-1
디스플레이NNG 개발자NNG 원NNG 팀NNG 뭉쳐VV 걸릴VV 일NNG 성과NNG ,1
졸속NNG 환경NNG 파괴NNG 난VV 개발NNG ,-1
```
  
위와 같이 이제 단순히 형태소 하나에 점수가 아닌 형태소 집합들에 점수가 매겨져 `투자NNG 유치NNG`와 `투자NNG 사기NNG`를 구별 할 수 있게 되었습니다. 특히나 랜덤포레스트를 통해 Bi-gram, Tri-gram으로 형태소들을 분석하여 훨씬 더 신뢰도 높은 결과값을 얻을 수 있었습니다.    

---

### 키워드 추출

이제 뉴스와 관련된 상장기업들을 찾아야 했습니다. 가장먼저 키워드 분석시 상장기업 리스트들을 하나의 형태소 단위로 인식을 해야하기 때문에 엘라스틱서치 nori 분석기 unser-dictionary에 상장기업명들을 등록시켜주었습니다. (이 작업을 진행하지 않는다면 `호텔신라`가 `호텔`  `신라`가 되는 참사가 일어날수 있습니다...) 
  
형태소분석기에 사전 작업이 끝났다면 이제 뉴스의 키워드를 뽑아낼수 있습니다. 단, 키워드를 뽑아낼때 모든 형태소를 대상으로 하지 않았습니다. 모든 형태소가 된다면 `-ㄴ다/EFN`와같은 종결어미나 접두사, 관형사 등이 키워드가 될 수 있기때문에 애초에 키워드가 될 수 있는 품사의 화이트리스트 ['NNG'(일반명사) ,'NNP'(고유명사) ,'NP'(대명사) ,'SL'(외국어)]로 관리하여 키워드 형태소 후보로 잡았습니다.  
또한 기사 제목에 나오는 형태소들에 키워드가 될 수 있는 가점을 주기위해 기사 제목에 나오는 형태소에는 +3, 기사 본문에 나오는 형태소에는 +1 점으로 더하여 최종 뉴스별 최종 키워드 5개 까지 선별해줍니다.   
  
---

### 연관 상장기업 추출
  
아직은 키워드별 상장기업과의 연관관계가 없기때문에 이 또한 학습데이터가 필요합니다. 이때는 뉴스별로 탑 5로 선정된 키워드들 중 상장기업명이 들어갈시 다른 키워드들을 해당 상장기업과의 연관키워드 데이터로써 저장시키는 방식을 사용했습니다. 이렇게 저장된 데이터는 아래와 같이 저장되어집니다.  

```
keyword,company,score
레모나,경남제약,0.3
스크린골프,골프존,0.3
BTS,넷마블,0.3
삼성전자,삼성물산,0.5
헬스케어,유비케어,0.3
```
  
위의 예시를 보시면 아시겠지만 키워드들 중에서도 연관성의 차이를 주기위해 '연관점수'를 두어 일반적인 키워드는 0.3점, 다른 상장기업명 키워드는 0.5점으로 연관 회사를 좀더 묶어줄수 있도록 했습니다.  
  
현재는 키워드 점수들의 합이 0.8 이상일때 해당 뉴스와 상장기업의 연관성이 있다고 정량적으로 판단하고 있습니다. 이후에 키워드 데이터가 많이생긴다면 해당 정량을 증가시켜 테스트 할 예정입니다.  
  
위와같은 방식으로 근 3년내의 뉴스기사 데이터를 모두 매칭해 5,000개 정도의 키워드 데이터를 수집하였고 실시간으로 크롤링하면서도 매칭되는 데이터들을 계속 학습시켜나가고 있습니다.  
  
---

### 뉴스 데이터 저장

이제 크롤러와 모든 알고리즘의 구현이 완료되었습니다. 이전 단계에서 구한 모든 알고리즘 들은 크롤러에서 뉴스기사를 하나씩 불러올때마다 실행하여 해당 뉴스를 판단하게 됩니다. 그 중,  다음과 같은 조건에 부합하면 뉴스데이터를 저장시킵니다.  

> 1\. 해당 뉴스의  Positive 점수가 1 혹은 -1 인가?  
> 2\. 해당 뉴스와 연관된 상장기업이 하나라도 있는가?  

위의 조건들이 부합시 엘라스틱서치에 뉴스데이터를 저장시켜 줍니다. 

---

### Django rest 구축

API는 저장된 뉴스를 조회할수 있도록 만들어주면 됩니다. 이를위해 Django-rest-framework 를 사용하여 간단하게 뉴스를 조회하는 api 를 만들어 주었습니다. 데이터를 불러올때는 초기 세팅, 실시간 최신 데이터, 이전 데이터 조회가 모두 필요하므로 크롤링 데이터를 기준으로 데이터를 조회 할 수 있도록 해주었습니다.   
  
이렇게 백엔드 개발기는 완료되었습니다. 다음은 프론트엔드 개발기로 이어집니다!

---
